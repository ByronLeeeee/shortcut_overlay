# 显键 (Shortcut Overlay) - 使用指南

本指南提供了如何使用和配置“显键”应用程序的详细说明。

## 目录

- [显键 (Shortcut Overlay) - 使用指南](#显键-shortcut-overlay---使用指南)
  - [目录](#目录)
  - [1. 运行应用程序](#1-运行应用程序)
  - [2. 使用系统托盘图标](#2-使用系统托盘图标)
  - [3. 理解悬浮键盘](#3-理解悬浮键盘)
  - [4. 配置设置](#4-配置设置)
    - [主题选择](#主题选择)
    - [自定义主题颜色](#自定义主题颜色)
    - [不透明度调整](#不透明度调整)
    - [语言选择](#语言选择)
  - [5. 自定义快捷键 (`shortcuts.json`)](#5-自定义快捷键-shortcutsjson)
    - [文件结构](#文件结构)
    - [查找可执行文件名](#查找可执行文件名)
    - [定义修饰键](#定义修饰键)
    - [定义无修饰键 ("NoModifier")](#定义无修饰键-nomodifier)
    - [按键命名约定](#按键命名约定)
    - [本地化描述](#本地化描述)
    - [添加新应用程序](#添加新应用程序)
    - [示例：添加 Word 快捷键](#示例添加-word-快捷键)
  - [6. 故障排除](#6-故障排除)

## 1. 运行应用程序

请遵循主 [README_zh.md 中的“安装与设置”部分](https://github.com/byronleeeee/shortcut-overlay/blob/main/README_zh.md#安装与设置) 来运行应用程序。启动后，悬浮键盘应出现在屏幕上，并且系统托盘区会添加一个图标。

## 2. 使用系统托盘图标

**右键**单击系统托盘中的“显键”图标，将提供以下选项：

*   **显示/隐藏悬浮窗**: 切换屏幕虚拟键盘的可见性。
*   **设置...**: 打开设置对话框以自定义外观和行为。
*   **关于...**: 显示应用程序的相关信息。
*   **退出**: 关闭应用程序。

双击托盘图标也会切换悬浮窗的显示/隐藏状态。

## 3. 理解悬浮键盘

屏幕上的虚拟键盘会显示常用按键。当你按下修饰键 (Ctrl, Shift, Alt, Win)，或者当特定应用程序处于前台时，悬浮键盘上的按键会更新以显示相关的快捷键描述。

*   **键帽文本**: 按键上的主要文本 (例如 "A", "Ctrl", "F1")。
*   **快捷键描述**: 出现在键帽文本下方的小号文本，描述快捷键的功能。此文本是上下文感知的。
*   **高亮快捷键**: 当一个修饰键组合激活时（例如，按住 Ctrl 键），该组合对应的快捷键描述会有一个高亮的背景，以便更清晰地查看。

可以通过单击并拖动悬浮窗的任何非按键或非调整大小手柄的区域来将其移动到屏幕上的任何位置。你可以使用右下角的调整大小手柄来调整窗口大小。

## 4. 配置设置

通过系统托盘图标 (`设置...`) 访问设置对话框。在此处所做的更改会立即应用。

### 主题选择

*   **主题**: 从预定义的外观主题列表中为悬浮键盘选择主题 (例如 "Default Dark", "Light Steel")。“Custom...” 主题允许使用个性化颜色。

### 自定义主题颜色

如果选择 "Custom..." 主题，以下选项将变为可用：

*   **背景颜色...**: 设置悬浮键盘窗口的主背景颜色。支持 Alpha 透明度。
*   **按键颜色...**: 设置悬浮键盘上各个按键控件的背景颜色。支持 Alpha 透明度。
*   **按键文本颜色...**: 设置键帽文本 (例如 "Ctrl", "A") 以及快捷键描述文本的颜色。

单击每个按钮以打开颜色选择器。

### 不透明度调整

*   **窗口不透明度**: 使用滑块调整悬浮键盘窗口的整体透明度，范围从 20% (非常透明) 到 100% (完全不透明)。

### 语言选择

*   **界面语言**: 在 "English" (英文) 和 "简体中文" 之间选择应用程序的用户界面语言 (对话框、菜单) 以及默认的快捷键描述。

## 5. 自定义快捷键 (`shortcuts.json`)

“显键”的强大之处在于其可自定义的快捷键定义。这些定义存储在应用程序安装目录下的 `config/shortcuts.json` 文件中。你可以使用任何文本编辑器编辑此文件。

**重要提示：** 在进行重大更改之前，建议备份你的 `shortcuts.json` 文件。如果文件损坏或被删除，应用程序将在下次启动时生成一个默认文件。

### 文件结构

`shortcuts.json` 文件是一个 JSON 对象。顶层键是应用程序的可执行文件名 (**大写**) 或特殊键 `"DEFAULT"`。

```json
{
  "应用程序名1.EXE": {
    // ... App1 的快捷键
  },
  "应用程序名2.EXE": {
    // ... App2 的快捷键
  },
  "DEFAULT": {
    // ... 全局快捷键或备用快捷键
  }
}
```

### 查找可执行文件名

要为新应用程序添加快捷键，你需要其确切的可执行文件名 (例如 `PHOTOSHOP.EXE`, `MY_APP.EXE`)。通常可以通过以下方式找到：
1.  运行该应用程序。
2.  打开任务管理器 (Ctrl+Shift+Esc)。
3.  在“进程”或“详细信息”选项卡中找到该应用程序。
4.  记下“映像名称”或“可执行文件名”。
将此名称**转换为大写**，并用作 `shortcuts.json` 中的键。

### 定义修饰键

在每个应用程序 (或 "DEFAULT") 条目内部，键是修饰键组合，如 `"Ctrl"`, `"Shift"`, `"Alt"`, `"Win"`, `"Ctrl+Shift"`, `"Ctrl+Alt"` 等。

```json
"NOTEPAD.EXE": {
  "Ctrl": { // 当 Ctrl 键被按下时
    "S": {"en": "Save", "zh": "保存"}, // Ctrl+S
    "O": {"en": "Open", "zh": "打开"}  // Ctrl+O
  },
  "Ctrl+Shift": { // 当 Ctrl 和 Shift 键同时被按下时
    "S": {"en": "Save As", "zh": "另存为"} // Ctrl+Shift+S
  }
}
```

### 定义无修饰键 ("NoModifier")

对于不需要按下 Ctrl, Shift, Alt 或 Win 键即可触发的快捷键 (例如，F1 代表帮助，或某些应用程序中的单字母工具快捷键)，请使用特殊的修饰键名 `"NoModifier"`：

```json
"PHOTOSHOP.EXE": {
  "NoModifier": {
    "V": {"en": "Move Tool", "zh": "移动工具"},
    "B": {"en": "Brush Tool", "zh": "画笔工具"},
    "F1": {"en": "Help", "zh": "帮助"}
  }
}
```
当没有其他相关的修饰键激活时，将显示这些快捷键。

### 按键命名约定

修饰键块内部的按键名 (例如 `"S"`, `"F1"`, `"SPACE"`) 应与应用程序的 `KeyboardHandler` 生成的**标准化按键名**相匹配。通常：
*   字母: 大写 (例如 `"A"`, `"S"`)
*   数字: `"0"`-`"9"`
*   功能键: `"F1"` - `"F12"` (或最高到 `"F24"`)
*   特殊键: 使用一致的大写名称，如 `"ESC"`, `"ENTER"`, `"SPACE"`, `"TAB"`, `"DELETE"`, `"HOME"`, `"END"`, `"PAGEUP"`, `"PAGEDOWN"`, `"LEFT"`, `"RIGHT"`, `"UP"`, `"DOWN"`, `"PRTSC"` (代表 PrintScreen), `"PAUSE"`。
*   符号: 如果是标准字符，则使用符号本身 (例如 `"-"`, `"="`, `"["`, `"]"`, `";"`)。

如果不确定，可以在 `KeyboardHandler._key_event_callback` 中临时添加 `print(f"Normalized key: {normalized_key}")` 来查看特定按键按下时生成的名称。

### 本地化描述

快捷键描述可以是简单的字符串 (如果你只使用一种语言) 或用于本地化的对象：
*   简单字符串: `"S": "保存"`
*   本地化对象: `"S": {"en": "Save File", "zh": "保存文件"}`

应用程序将尝试显示当前所选 UI 语言的描述。如果找不到，它将尝试备用语言 (如果当前是中文则为英文，如果当前是英文则为中文)，然后是第一个可用的描述。

### 添加新应用程序

1.  找到可执行文件名 (例如 `MYCOOLAPP.EXE`)。
2.  在 `shortcuts.json` 中添加一个新的顶层条目：
    ```json
    "MYCOOLAPP.EXE": {
      "Ctrl": {
        "Q": {"en": "Quick Action", "zh": "快捷动作"}
      },
      "NoModifier": {
        "H": {"en": "Show Help Panel", "zh": "显示帮助面板"}
      }
    }
    ```
3.  保存 `shortcuts.json`。当 `MYCOOLAPP.EXE` 成为前台应用程序时，悬浮窗应自动加载这些更改。(如果应用程序没有立即加载文件更改，或者 `ConfigManager` 没有实时重载功能，可能需要重新启动悬浮窗)。

### 示例：添加 Word 快捷键

假设 `WINWORD.EXE` 条目已存在：

```json
"WINWORD.EXE": {
    "Ctrl": {
      "S": { "en": "Save", "zh": "保存" },
  }
}
```

## 6. 故障排除

*   **某个应用的快捷键未显示**:
    *   验证 `shortcuts.json` 中的可执行文件名 (大写，包含 `.EXE`) 是否与前台监控器检测到的完全匹配。
    *   确保 `shortcuts.json` 文件是有效的 JSON 格式。你可以使用在线 JSON 验证器。
    *   检查是否定义了正确的修饰键组合。
*   **悬浮窗不可见**:
    *   右键单击托盘图标并选择 “显示/隐藏悬浮窗”。
    *   检查不透明度设置；可能设置得太低。
*   **应用程序崩溃或报错**:
    *   检查控制台输出以获取错误信息。
    *   确保所有系统需求都已在你的 Python 环境中正确安装。